<html>
  <!-- To try locally, run: `yarn build` and then `npx http-server -o` -->

  <body>
    <table>
      <tbody></tbody>
    </table>
    <script type="module">
      import {
        getAuth,
        getUser,
        callService,
        createConnection,
        subscribeEntities,
		ERR_HASS_HOST_REQUIRED
      } from "./haws.umd.js";
        

      (async () => {
        let auth;
        try {
          auth = await getAuth();
        } catch (err) {
          if (err === ERR_HASS_HOST_REQUIRED) {
            const hassUrl = prompt(
              "What host to connect to?",
              "http://192.168.1.111:8123"
            );
            if (!hassUrl) return;
            auth = await getAuth({ hassUrl });
          } else {
            alert(`Unknown error: ${err}`);
            return;
          }
        }
        const connection = await createConnection({ auth });
        subscribeEntities(connection, entities =>
          renderEntities(connection, entities)
        );

        // To play from the console
        window.auth = auth;
        window.connection = connection;
        getUser(connection).then(user => console.log("Logged in as", user));
      })();

      function renderEntities(connection, entities) {
        const root = document.querySelector("tbody");
        while (root.lastChild) root.removeChild(root.lastChild);
		    console.log(entities);
		var devices=[]
        Object.keys(entities)
          .sort()
          .forEach(entId => {
			if (entId.startsWith("switch") || entId.startsWith("light") || entId.startsWith("media")){
				const tr = document.createElement("tr");

				const tdName1 = document.createElement("td");
				tdName1.innerHTML = entities[entId].attributes.friendly_name;
				tr.appendChild(tdName1);
        

        const tr1 = document.createElement("tr");

        const tdName = document.createElement("td");
        tdName.innerHTML = JSON.stringify(entities);
        tr1.appendChild(tdName);
        root.appendChild(tr1);
				root.appendChild(tr);
				devices.push(entities[entId].attributes.friendly_name);
			}
            
          });
		console.log(devices)
      }
    </script>
  </body>
</html>